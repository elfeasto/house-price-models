Rewrite k_nn using new general_CFV function
Rewrite other scripts that use CFV with this new function